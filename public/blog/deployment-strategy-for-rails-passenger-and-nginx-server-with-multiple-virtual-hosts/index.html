
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Deployment Strategy for Rails, Passenger and Nginx server with Multiple Virtual Hosts - Ikenna Okpala: London Based Software Developer </title>
  <meta name="author" content="Ikenna Okpala">

  
  <meta name="description" content="Hi, I am Ikenna Okpala, a london based software developer. This is my personal website and blog. I spend my daytime building Web Applications (Development and Architecture), Agile Coaching and Life Enrichment. Feel free to look around. There is not traffic in the extra mile. --Rickey Minor">
  <!-- <meta name="description" content="In this blog post i intend to share notes taken during deployment exercise of rails apps on Multiple Virtual Hosts. I have decided to put this all &hellip;"> -->
  
  <meta name="keywords" content="web development specialist, ruby, ruby on rails, javascript and/or coffeescript, jquery, underscrore.js, backbone.js, java, scala, , postgresql, mysql, teradata, oracle, unix/linux, nginx, git, capistrano and agile methodologies">
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ikennaokpala.com/blog/deployment-strategy-for-rails-passenger-and-nginx-server-with-multiple-virtual-hosts">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Ikenna Okpala" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-40007650-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="mailto:me@ikennaokpala.com?Subject=Hello" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ikennaokpala.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="blue_light">
            Ikenna Okpala
        </span>
       
           <span class="blue_dark">
             
           </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Deployment Strategy for Rails, Passenger and Nginx Server With Multiple Virtual Hosts</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-27T05:01:04+00:00" pubdate data-updated="true">Dec 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In this blog post i intend to share notes taken during deployment exercise of rails apps on Multiple Virtual Hosts.</p>

<p>I have decided to put this all down for self reference and possibly interesting debates that may help expose areas that i am not be aware of.</p>

<!--more-->


<p>Deploying rails apps from a beginners perspective (like mine) could be really confusing.</p>

<p>This note will show how i have come to avoid breaking the passenger-nginx compilation and deploying rails apps to Multiple Virtual Hosts.</p>

<p>The development stack/environment is based on the following technologies:</p>

<ul>
<li><p>Centos</p>

<ul>
<li><p>Run these commands to find out what version of Centos your server is.</p></li>
<li><p><code>cat /etc/redhat-release</code> gives me: &#8220;CentOS Linux release 6.0 (Final)&#8221;</p></li>
<li><p><code>uname -a</code> gives me: &#8220;Linux servername-xxx 2.6.32-71.29.1.el6.x86_64 #1 SMP Mon Jun 27 19:49:27 BST 2011 x86_64 x86_64 x86_64 GNU/Linux&#8221;</p></li>
</ul>
</li>
<li><p>Nginx Web Server</p></li>
<li><p>RVM 1.10.0</p></li>
<li><p>Phusion Passenger 3.0.11</p></li>
<li><p>Ruby 1.9.2 patch level 290</p></li>
<li><p>Rails 3.1.3</p></li>
</ul>


<p>It is worthy of note that at the time of writting this post the urls and rpm are valid. if you encounter any not found kinda error, you can google to find the rpm and the include it to the centos repo file.</p>

<div>
  <pre><code class='bash'>sudo vim /etc/yum.repos.d/CentOS-Base.repo</code></pre>
</div>


<p><strong>Firstly, before we get started we need to setup the following</strong></p>

<p><em>Setup a deployment user account</em>
Our rails application will run as user: deployerbot.
To create a deployerbot, allocate it to a group, modify the deployerbot user password and then add deployerbot to sudoers file.</p>

<div>
  <pre><code class='bash'>groupadd staff # if staff does not exist (cat /etc/groups | grep staff)
useradd -m -g staff -s /bin/bash deployerbot # if you need to add deploybot user to more groups  usermod -G grp1,grp2,newgrp username
passwd deployerbot
visudo  # edit to include deployerbot to the sudoers file.. notice that i changed this to visudo instead of vim /etc/sudoers.. this is a safer way to edit sudoers. see this link for more on visudo http://linux.about.com/library/cmd/blcmdl8_visudo.htm.. thanks to Geoff Low (gflow) for the correction..

# include this line below  &#39;root ALL=(ALL) ALL&#39;: to enable deployerbot to use the sudo command
deployerbot ALL=(ALL) ALL
#or alternatively add the staff group below  &#39;root ALL=(ALL) ALL&#39;: to enable deployerbot to use the sudo command as a member of the group
%staff ALL=(ALL) ALL
#login as the newly created user and create the ssh key
ssh-keygen -t rsa -b 4096</code></pre>
</div>


<p>More on <a href="http://ubuntuforums.org/showthread.php?t=904796">ssh and its key generation here</a>
Now the web applications are going to run in production-mode, include this line to /etc/environment to avoid repeating it for every kind of Rails like commands:</p>

<div>
  <pre><code class='bash'>RAILS_ENV=production</code></pre>
</div>


<p>_Install RVM _
Make sure you have all the essential armoury (dependencies) :)</p>

<div>
  <pre><code class='bash'>yum groupinstall &quot;Development Tools&quot;  # ubuntu equivalent may be this apt-get install build-essential ruby-full libmagickcore-dev imagemagick libxml2-dev libxslt1-dev git-core ruby-devel libxml2 libxml2-devel libxslt libxslt-devel

yum install kernel-devel kernel-headers # this may already have been installed by default

yum install openssl-devel libcurl-devel ImageMagick httpd-devel ruby-libs zlib-devel libjpeg-devel giflib-devel readline-devel

# or this could also work as well if the above fails

sudo rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-4.noarch.rpm

yum -y install libpcap libpcap-devel libnet libnet-devel pcre pcre-devel gcc automake autoconf libtool make gcc-c++ libyaml libyaml-devel zlib zlib-devel pkgconfig ruby-devel libxml2 libxml2-devel libxslt libxslt-devel</code></pre>
</div>


<p>Check out this <a href="http://www.openinfosecfoundation.org/doc/INSTALL.txt">link</a> for more information</p>

<p>To Install RVM on Centos this following command is require (do this as the deployment user). Also make sure you already have curl and git installed.</p>

<div>
  <pre><code class='bash'>bash &lt; &lt;(curl -s https://rvm.beginrescueend.com/install/rvm) # after installation, rvm should be ready to use.. if not reboot

rvm notes # to find out if there are any system specific setting that require attention.. for centos you may need to create a .screenrc file with only this as its content shell -/bin/bash

usermod -a -G staff,rvm deployerbot  #modify deployerbot to multiple groups rvm and staff</code></pre>
</div>


<p>For Centos depending on the version you are running on i would advise run the command below for more information</p>

<div>
  <pre><code class='bash'>rvm notes</code></pre>
</div>


<p><em>Install Ruby and Upgrade RubyGems</em>
For precautionary reason install 1.9.2 with the following packages: (do this as the deployment user)</p>

<div>
  <pre><code class='bash'>rvm pkg install readline # you may want to do (--skip-autoreconf) this for each package to avoid autoreconf error: rvm --skip-autoreconf pkg install readline
rvm pkg install zlib
rvm pkg install openssl
rvm install 1.9.2 --with-openssl-dir=$rvm_path/usr --with-readline-dir=$rvm_path/usr # with zlib optional rvm install 1.9.2 --with-zlib-dir=$rvm_path/usr --with-openssl-dir=$rvm_path/usr --with-readline-dir=$rvm_path/usr
rvm use 1.9.2 # to make this the system&#39;s ruby do: rvm --default use 1.9.2

# Upgrade RubyGems to the latest (stable) and greatest.. :)
wget http://rubyforge.org/frs/download.php/xxxxx/rubygems-x.x.x*.tgz
tar zxvf rubygems-x.x.x*.tgz
cd rubygems-x.x.x*
ruby setup.rb
# to confirm rubygem upgrade:
gem -v</code></pre>
</div>


<p><em>Create a Gemsets for each web application</em>
This blog focuses on deployment on multiple virtual hosts we will be creating two gemsets demonstration purposes.</p>

<div>
  <pre><code class='bash'>rvm gemset create webapp1
rvm gemset create webapp2</code></pre>
</div>


<p>On the server create a ~/.gemrc file</p>

<div>
  <pre><code class='bash'>:verbose: true
:bulk_threshold: 1000
install: --no-ri --no-rdoc --env-shebang
:sources:
- http://gemcutter.org
- http://gems.rubyforge.org/
- http://gems.github.com
:benchmark: false
:backtrace: false
update: --no-ri --no-rdoc --env-shebang
:update_sources: true</code></pre>
</div>


<p><strong>
To deploy these apps on Nginx</strong>
<em>Install and setup passenger and nginx</em>
Passenger as i have come to know is simply mod_rails pr mod ruby for webservers like nginx.
now here is where i have observed that i made a big mistake. Now because you have multiple virtual host sitting on the server, they are mostly likely not useing the exactly set of gems and even possibly may different rubies.</p>

<p>With RVM installed on the server, your RVM directory is located here &#8220;$HOME/.rvm/&#8221; probably has taken this form.</p>

<div>
  <pre><code class='bash'>cd $HOME/.rvm/gems/
ls

# archives  environments  help     log        README   tmp      wrappers
# bin       examples      hooks    man        rubies   user
# config    gems          lib      patches    scripts  usr
# contrib   gemsets       LICENCE  patchsets  src      VERSION</code></pre>
</div>


<p>Out of all these we are interested in two folders the gems and wrapper.</p>

<p>A brief look into the gems folder you will find the following</p>

<div>
  <pre><code class='bash'>cd gems
ls

# cache            ruby-1.9.2-p290@webapp1      ruby-1.9.2-p290@webapp2
# ruby-1.9.2-p290  ruby-1.9.2-p290@global</code></pre>
</div>


<p>Because we want to maintain virtual host and accommodate dissimilarities between webapp1 and webapp2</p>

<p>I suggest installing passenger in the ruby-1.9.2-p290 gemset folder. This will avoid breaking passenger on each deployment of any of the two web applications, because for each time you reload or reinstall your gems , there is a big propensity of getting the passenger-nginx link broken. Hence the need to recompile passenger for nignx on the server.</p>

<p>This could also lead to errors like:</p>

<ul>
<li><p>500 internal server error</p></li>
<li><p>403 Forbidden</p></li>
<li><p>[Tue Dec 27 22:43:57 2011] [error] *** Passenger could not be initialised because of this error: Unable to start the Phusion Passenger watchdog because it encountered the following error during startup: Unable to start the Phusion Passenger logging agent because its executable (/path/to/gems/passenger-3.0.11/agents/PassengerLoggingAgent) doesn&#8217;t exist. This probably means that your Phusion Passenger installation is broken or incomplete. Please reinstall Phusion Passenger</p></li>
</ul>


<p>So i think it&#8217;s better to have the passenger gem separate from the gemsets for the web application. This will not require recompiling passenger on every deployment, hence leaving a high chance of downtime problems.</p>

<p>Now i have come across solutions like unicorn, but for now what is obtain in my environment is passenger. Burt will be checking unicorn out pretty soon.</p>

<p>To achieve this do the following (perform this as the deployment user):</p>

<div>
  <pre><code class='bash'>rvm use 1.9.2 # load the ruby-1.9.2-p290 folder into your current session

gem install passenger # this should install passenger to the ruby-1.9.2-p290 folder

passenger-install-nginx-module # do this to setup/compile passenger with nginx</code></pre>
</div>


<p>At a certain stage of the <em>passenger-install-nginx-module</em> you will be asked to chose to between two setup processes. For me i will take the number 1 option of installing nginx from scratch which is the recommended option. This also makes sense since so far we have not installed nginx.</p>

<p><em>Nginx Virtual Host Configuration</em>
For nginx assuming that decided to install it in /etc/nginx/ passenger will locate the nginx.conf in the conf folder. To correctly link passenger and nginx the copy the following to your nginx.conf file</p>

<div>
  <pre><code class='bash'>user  deployerbot staff;

worker_processes  2;

events {
    worker_connections  1024;
}
http {
    passenger_root /usr/local/rvm/gems/ruby-1.9.2-p290/gems/passenger-3.0.11;
    passenger_ruby /usr/local/rvm/wrappers/ruby-1.9.2-p290/ruby;

    include       mime.types;
    default_type  application/octet-stream;

    access_log  /etc/nginx/logs/access.log;
    error_log  /etc/nginx/logs/error.log;

    sendfile        on;
    keepalive_timeout  65;
    include /etc/nginx/conf.d/*.conf;
}</code></pre>
</div>


<p>Before the next steps create the conf.d directory. I personal prefer to keep them inside conf.d. You can chosen to keep yours somewhere else only remember to link it up.</p>

<div>
  <pre><code class='bash'>mkdir conf.d</code></pre>
</div>


<p>Now for webapp1 you want to configure you server something like this</p>

<div>
  <pre><code class='bash'>server {
    # if you&#39;re running multiple servers, instead of &quot;default&quot; you should
    # put your main domain name here
    listen 80;

    # you could put a list of other domain names this application answers
    server_name webapp1.com;

    root /var/www/path/to/webapp1/current/public;
    access_log /var/www/path/to/webapp1/logs/webapp1.access.log;
    error_log /var/path/to/webapp1/logs/webapp1.error.log;

    rewrite_log on;

    passenger_enabled on;
}</code></pre>
</div>


<p>And for webapp2 we have</p>

<div>
  <pre><code class='bash'>server {
    # if you&#39;re running multiple servers, instead of &quot;default&quot; you should
    # put your main domain name here
    listen 80;

    # you could put a list of other domain names this application answers
    server_name webapp2.com;

    root /var/www/path/to/webapp2/current/public;
    access_log /var/www/path/to/webapp2/logs/webapp2.access.log;
    error_log /var/path/to/webapp2/logs/webapp2.error.log;

    rewrite_log on;

    passenger_enabled on;
}</code></pre>
</div>


<p>Obviously the above steps do not settle it all. We need to create our web app.</p>

<div>
  <pre><code class='bash'>rails new webapp1
rails new webapp2</code></pre>
</div>


<p>Create a ~/.rvmrc to trust your .rvmrc project files and (create) load the project specific gemset</p>

<div>
  <pre><code class='bash'>rvm_trust_rvmrcs_flag=1

if [[ -s &quot;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1&quot; ]] ; then
  . &quot;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1&quot;
else
  rvm --create use  &quot;1.9.2@webapp1&quot;
fi</code></pre>
</div>


<p>Here comes another part.</p>

<p>Unlike <a href="http://httpd.apache.org/docs/2.0/mod/mod_env.html">Apache&#8217;s SetEnv feature</a>, nginx does not allow setting of environment variable rather relies on the shell for environment variables.</p>

<p>Passenger on the other hand is a shel script and will use the default settings of the shell if the rails application does not specify its own settings.</p>

<p>To avoid this problem, you need to set environment variable for each application (webapp1 and webapp2).</p>

<p>To do this edit config/production.rb with the following:</p>

<div>
  <pre><code class='ruby'>WebApp1::Application.configure do
# Settings specified here will take precedence over those in config/application.rb

  # Code is not reloaded between requests
  config.cache_classes = true #..........
# .....................................
end

#paste this at the bottom and edit this part with your own relevant paths

ENV[&#39;GEM_HOME&#39;]=&#39;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems&#39; # take note for webapp2 it will be /usr/local/rvm/gems/ruby-1.9.2-p290@webapp2/gems
ENV[&#39;GEM_PATH&#39;]=&#39;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems:/usr/local/rvm/gems/ruby-1.9.2-p290@global/gems&#39;
ENV[&#39;PATH&#39;]=&#39;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/bin:$PATH&#39;
ENV[&#39;MY_RUBY_HOME&#39;]=&#39;/usr/local/rvm/wrappers/ruby-1.9.2-p290@webapp1/ruby&#39;</code></pre>
</div>


<p>The above will set the environment variable for the rails application to the gemset folder <em>/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems</em> as well as all others.</p>

<p>Next you need to create a in the config folder setup_load_paths.rb this is well explained in <a href="http://beginrescueend.com/integration/passenger/">this post</a>
Copy and paste the following:</p>

<div>
  <pre><code class='ruby'>if ENV[&#39;MY_RUBY_HOME&#39;] &amp;&amp; ENV[&#39;MY_RUBY_HOME&#39;].include?(&#39;rvm&#39;)
  begin
    rvm_path = File.dirname(File.dirname(ENV[&#39;MY_RUBY_HOME&#39;]))
    rvm_lib_path = File.join(rvm_path, &#39;lib&#39;)
    $LOAD_PATH.unshift rvm_lib_path
    require &#39;rvm&#39;
    RVM.use_from_path! File.dirname(File.dirname(__FILE__))
  rescue LoadError
    # RVM is unavailable at this point.
    raise &quot;RVM ruby lib is currently unavailable.&quot;
  end
end

# Pick the lines for your version of Bundler
# If you&#39;re not using Bundler at all, remove all of them

# Require Bundler 1.0
ENV[&#39;BUNDLE_GEMFILE&#39;] = File.expand_path(&#39;../Gemfile&#39;, File.dirname(__FILE__))
require &#39;bundler/setup&#39;

# Require Bundler 0/9
# if File.exist?(&quot;.bundle/environment.rb&quot;)
#   require &#39;.bundle/environment&#39;
# else
#   require &#39;rubygems&#39;
#   require &#39;bundler&#39;
#   Bundler.setup
# end</code></pre>
</div>


<p>Now last part is the Capistrano recipe to compliment the above setting.</p>

<div>
  <pre><code class='bash'># First of all create capistrano files with this
capify .</code></pre>
</div>


<p>Following the above copy this part to the Capfile:</p>

<div>
  <pre><code class='ruby'># this part goes in the Capfile which is located in the root of your rails app

# Add RVM&#39;s lib directory to the load path.
$:.unshift(File.expand_path(&#39;./lib&#39;, ENV[&#39;rvm_path&#39;]))
# Load RVM&#39;s capistrano plugin.
require &quot;rvm/capistrano&quot;
# Set it to the ruby + gemset of your app, e.g:
set :rvm_ruby_string, &#39;1.9.2@webapp1&#39;</code></pre>
</div>




<div>
  <pre><code class='ruby'>#this part goes in the deploy.rb file inside the config in your rails app

require &#39;bundler/capistrano&#39;
set :application, &quot;webapp1.com&quot;

set :domain, &quot;www.domain.com&quot;
set :environment, &quot;production&quot;
set :branch, &quot;master&quot;
set :deploy_to, &quot;/var/www/path/to/www/webapp1&quot;

role :app, domain
role :web, domain
role :db, domain, :primary =&gt; true

default_run_options[:pty] = true

default_run_options[:shell] = &#39;bash&#39;

default_environment[&quot;RAILS_ENV&quot;] = &#39;production&#39;

set :repository, &quot;git@ domain.com/webapp1.git&quot;
set :deploy_via, :remote_cache

# If you aren&#39;t using Subversion to manage your source code, specify
# your SCM below:
set :scm, :git
set :scm_verbose, true
set :use_sudo, false
set :ssh_options, :forward_agent =&gt; true

set :user, &quot;deployerbot&quot;
set :keep_releases, 7

set :default_environment, {
    &#39;PATH&#39; =&gt; &quot;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems/bin:$PATH&quot;,
    &#39;RUBY_VERSION&#39; =&gt; &#39;ruby 1.9.2&#39;,
    &#39;GEM_HOME&#39; =&gt; &#39;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems&#39;,
    &#39;GEM_PATH&#39; =&gt; &#39;/usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems:/usr/local/rvm/gems/ruby-1.9.2-p290@global/gems&#39;,
    &#39;BUNDLE_PATH&#39; =&gt; &#39;//usr/local/rvm/gems/ruby-1.9.2-p290@webapp1/gems&#39; # If using bundler.
}

namespace :deploy do
  desc &quot;restarting&quot;
  task :restart do
    run &quot;touch #{current_path}/tmp/restart.txt&quot;
  end

  desc &quot;symlink vendor to shared vendor&quot;
  task :symlink_vendor_to_shared_vendor do
    run &quot;ln -s #{current_path}/../shared/vendor #{current_path}/vendor&quot;
  end

  desc &quot;trust rvmrc&quot;
  task :trust_rvmrc do
    run &quot;rvm rvmrc trust #{release_path}&quot;
  end
end

after &#39;deploy:symlink&#39;, &#39;deploy:symlink_vendor_to_shared_vendor&#39;, &#39;deploy:trust_rvmrc&#39;</code></pre>
</div>


<p>Next do</p>

<div>
  <pre><code class='bash'>cap deploy:setup
cap deploy:cold
cap deploy</code></pre>
</div>


<p>On the server you want to load each application&#8217;s gemset and do bundle install</p>

<div>
  <pre><code class='bash'>rvm use 1.9.2@webapp1
cd /var/www/path/to/www/webapp1
bundle install

rvm use 1.9.2@webapp2
cd /var/www/path/to/www/webapp2
bundle install</code></pre>
</div>


<p>Do keep in mind, that if you start nginx manually, including the sudo -E will inform sudo to preserve your environment. If this is not done, sudo will possibly reset all your environment variables.</p>

<div>
  <pre><code class='bash'>cd /etc/nginx/sbin/
sudo -E ./nginx</code></pre>
</div>


<p>After doing this, nginx is sure to use the your chosen set of configuration.</p>

<p>Here ends the deployment notes, please feel free to comment below.</p>

<p>And away we go ! Ciao for now..</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ikenna Okpala</span></span>

      








  


<time datetime="2011-12-27T05:01:04+00:00" pubdate data-updated="true">Dec 27<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bash/'>BASH</a>, <a class='category' href='/blog/categories/capistrano/'>CAPISTRANO</a>, <a class='category' href='/blog/categories/nginx/'>NGINX</a>, <a class='category' href='/blog/categories/rails/'>RAILS</a>, <a class='category' href='/blog/categories/ruby/'>RUBY</a>, <a class='category' href='/blog/categories/rvm/'>RVM</a>, <a class='category' href='/blog/categories/unix/'>UNIX</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://ikennaokpala.com/blog/deployment-strategy-for-rails-passenger-and-nginx-server-with-multiple-virtual-hosts" data-via="ikenna_okpala" data-counturl="http://ikennaokpala.com/blog/deployment-strategy-for-rails-passenger-and-nginx-server-with-multiple-virtual-hosts" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/postgres-native-extension-error" title="Previous Post: Postgres gem native extension error">&laquo; Postgres gem native extension error</a>
      
      
        <a class="basic-alignment right" href="/blog/functional-thinking" title="Next Post: Functional Thinking">Functional Thinking &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite">
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/fix-openvpn-network-interface-mismatch">Fix OPENVPN Network Interface Mismatch</a>
      </li>
    
      <li class="post">
        <a href="/blog/a-look-at-Teradata-AMPs-">A Look At Teradata AMPs</a>
      </li>
    
      <li class="post">
        <a href="/blog/pow-ruby-version">Using .ruby-version with pow</a>
      </li>
    
      <li class="post">
        <a href="/blog/install-teradata-odbc-for-ruby-development">Install Teradata ODBC for Ruby development</a>
      </li>
    
      <li class="post">
        <a href="/blog/prioritizing-my-backlog-with-economics">Prioritizing My Backlog With Economics</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/ikennaokpala">@ikennaokpala</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ikennaokpala',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/kengimel?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/kengimel">My Delicious Bookmarks &raquo;</a></p>
</section>

<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:kengimel">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "kengimel"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/111621580960500743451?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section class="twitter2">
  <h1><a href="https://twitter.com/ikenna_okpala">@ikenna_okpala</a></h1>
  <br/>  <br/>
  <a href="https://twitter.com/ikenna_okpala" class="twitter-follow-button" data-show-count="false" data-lang="en" data-size="large">Follow @ikenna_okpala</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Ikenna Okpala -
  <span class="credit"><a href="/privacy"> Privacy Policy </a></span> -
  <span class="credit">Powered by <a href="http://octopress.org" target="_blank">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ikennaokpalasblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ikennaokpala.com/blog/deployment-strategy-for-rails-passenger-and-nginx-server-with-multiple-virtual-hosts';
        var disqus_url = 'http://ikennaokpala.com/blog/deployment-strategy-for-rails-passenger-and-nginx-server-with-multiple-virtual-hosts';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
